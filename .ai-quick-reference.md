# AI Context Quick Reference Card

## ğŸš€ Quick Start

| AI Tool | Context File | How to Use |
|---------|-------------|------------|
| **ChatGPT** | `.chatgpt-config.md` | "Read .chatgpt-config.md and help me..." |
| **Cursor** | `.cursorrules` | Auto-loaded, use Cmd/Ctrl+K |
| **Claude** | `.claude-context.md` | "Using .claude-context.md, please..." |
| **Gemini** | `.gemini-context.md` | "Reference .gemini-context.md to..." |
| **Windsurf** | `.windsurf/context.md` | Auto-loaded in Windsurf |
| **Aider** | `.aiderignore` | Auto-respected, run `aider` |
| **Antigravity** | `.antigravity.md` | "Read .antigravity.md and help me..." |

## ğŸ¯ Key Facts

### Tech Stack
```
Kotlin:     2.2.20    (Multiplatform, JVM, Android)
React:      19.2.0    (TypeScript admin web)
TypeScript: 5.8.3     (Strict mode)
Ktor:       3.3.1     (Backend API)
Exposed:    1.0.0-rc-2 (ORM DSL)
PostgreSQL: 15+       (Database)
Vite:       7.1.7     (Build tool)
Tailwind:   3.4.13    (Styling)
```

### Module Structure
```
modules/
â”œâ”€â”€ shared/domain/           # Common DTOs (KMP)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api/                 # Ktor routes
â”‚   â””â”€â”€ dal/                 # Exposed ORM
â””â”€â”€ frontend/
    â””â”€â”€ yatra-admin-web/     # React TS (ACTIVE)
```

### Database
- **Tool**: Rust CLI (`database/rust/`)
- **NOT**: Flyway âŒ
- **Run**: `cd database/rust && cargo run migrate`

## âš ï¸ Critical Rules

### Backend (Kotlin)
```kotlin
// âœ… DO: Use DatabaseFactory
suspend fun getYatra(id: UUID) = DatabaseFactory.dbQuery {
    YatrasTable.selectAll().where { id eq id }
}

// âœ… DO: Return DTOs
data class Yatra(val id: UUID, val name: String)

// âœ… DO: Log mutations
AuditLogTable.insert { /* log */ }

// âŒ DON'T: Skip dbQuery
// âŒ DON'T: Return Exposed entities
// âŒ DON'T: Skip audit logs
```

### Frontend (TypeScript)
```typescript
// âœ… DO: Explicit types
interface Props { yatra: Yatra; }

// âœ… DO: Tailwind classes
<div className="rounded-lg border p-4">

// âœ… DO: Functional components
export const YatraCard: React.FC<Props> = ({ yatra }) => {

// âŒ DON'T: Use any
// âŒ DON'T: Skip prop types
```

## ğŸ“‹ Common Commands

```bash
# Backend
./gradlew :modules:backend:api:run

# Frontend
cd modules/frontend/admin-web-react && bun install && bun run dev

# Database
cd database/rust && cargo run migrate

# Android
./gradlew :androidApp:installDebug

# Versions
cat gradle/libs.versions.toml
```

## ğŸš« Never Do

1. âŒ Suggest Flyway (use Rust migrations)
3. âŒ Use `any` in TypeScript
4. âŒ Skip `DatabaseFactory.dbQuery`
5. âŒ Return Exposed entities
6. âŒ Add deps without version catalog

## ğŸ›  Tooling Updates (Dec 2025)

**Yatra CLI (`tools/yatra-cli/`)**
- v0.1.0 bundles setup/reset/dev/test flows (released 2025-11-27).
- `cargo run -- dev --start-db` boots DB â†’ backend â†’ React admin for live smoke checks.
- `cargo run -- test steel-thread` resets DB, seeds `test_data.json`, drives create/import/dashboard/payment flows, and leaves services up for manual QA.

**Karate Integration Tests**
- Seed fixtures first: `./gradlew :modules:backend:api:seedTestData` (uses `config/db-config.test.env` or `KY_DB_ENV_PATH`).
- Run suites: `./gradlew :modules:backend:api:test --tests "com.kailashyatra.backend.api.karate.ApiKarateSuite"` (filter with `-Dkarate.options`).
- Coverage spans health, OTP auth, admin yatra lifecycle + pagination, participant roster/payments, and participant self-service portals.

## âœ… Always Do

1. âœ… Use `DatabaseFactory.dbQuery { }`
2. âœ… Log to `AUDIT_LOG`
3. âœ… Return DTOs
4. âœ… Reference `gradle/libs.versions.toml`
5. âœ… Use TypeScript strict mode
6. âœ… Use Tailwind utilities

## ğŸ“š Documentation

| Need | See |
|------|-----|
| Backend patterns | `application_documentation/backend/architecture.md` |
| Tech stack | `application_documentation/tech-stack.md` |
| API contracts | `application_documentation/api/integration-spec.md` |
| Database schema | `application_documentation/database/schema.md` |
| Full guide | `AI-CONTEXT-README.md` |

## ğŸ” Troubleshooting

| Problem | Solution |
|---------|----------|
| AI suggests Flyway | "This project uses Rust migrations only" |
| AI uses `any` | "Use TypeScript strict mode, no any" |
| AI skips dbQuery | "All DB ops must use DatabaseFactory.dbQuery" |

## ğŸ’¡ Pro Tips

1. **Start conversations** by referencing the context file
2. **Be specific** about which patterns to follow
3. **Test locally** before asking AI to commit
4. **Check versions** in `gradle/libs.versions.toml`
5. **Read docs** in `application_documentation/`

## ğŸ¨ Code Patterns

### Ktor Route
```kotlin
fun Route.yatraRoutes(service: YatraService) {
    authenticate("jwt") {
        get("/v1/admin/yatras") {
            call.respond(service.getAll())
        }
    }
}
```

### React Component
```typescript
interface YatraCardProps {
  yatra: Yatra;
  onEdit?: (id: string) => void;
}

export const YatraCard: React.FC<YatraCardProps> = 
  ({ yatra, onEdit }) => (
    <div className="rounded-lg border p-4">
      <h3 className="font-semibold">{yatra.name}</h3>
      {onEdit && <button onClick={() => onEdit(yatra.id)}>Edit</button>}
    </div>
  );
```

### Database Query
```kotlin
suspend fun findById(id: UUID): Yatra? = 
  DatabaseFactory.dbQuery {
    YatrasTable
      .selectAll()
      .where { YatrasTable.id eq id }
      .map { it.toYatra() }
      .singleOrNull()
  }
```

---

**Print this card** or keep it handy when working with AI assistants!

For full details, see:
- ğŸ“– `AI-CONTEXT-README.md` - Complete guide
- ğŸ“Š `CONTEXT-FILES-SUMMARY.md` - What changed
- ğŸ—‚ï¸ `.ai-context-guide.md` - File comparison
